{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\n// import { setAlert } from \"./alert\";\n\nconst initialState = {\n  posts: [],\n  post: null,\n  error: {},\n  loading: true\n};\nconst postSlice = createSlice({\n  name: \"post\",\n  initialState,\n  reducers: {\n    getPostsSuccess(state, action) {\n      state.posts = action.payload;\n      state.post = null;\n      state.loading = false;\n    },\n    createPostSuccess(state, action) {\n      state.posts.unshift(action.payload);\n      state.loading = false;\n    },\n    postError(state, action) {\n      state.error = action.payload;\n      state.loading = false;\n    },\n    updateLikes(state, action) {\n      const {\n        id,\n        likes\n      } = action.payload;\n      state.posts = state.posts.map(post => post._id === id ? {\n        ...post,\n        likes\n      } : post);\n      state.loading = false;\n    },\n    removePost(state, action) {\n      state.posts = state.posts.filter(post => post._id !== action.payload);\n      state.loading = false;\n    },\n    getPostSuccess(state, action) {\n      state.post = action.payload;\n      state.loading = false;\n    },\n    addOrRemoveComment(state, action) {\n      state.post = {\n        ...state.post,\n        comments: action.payload\n      };\n      state.loading = false;\n    }\n  }\n});\nexport const {\n  getPostsSuccess,\n  createPostSuccess,\n  postError,\n  updateLikes,\n  removePost,\n  getPostSuccess,\n  addOrRemoveComment\n} = postSlice.actions;\n\n// Async Thunks\nexport const getPosts = () => async dispatch => {\n  try {\n    const token = localStorage.getItem(\"token\");\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"x-auth-token\": `${token}` // Include the token in the Authorization header\n      }\n    };\n\n    const res = await axios.get(\"/api/posts\", config);\n    dispatch(getPostsSuccess(res.data));\n  } catch (error) {\n    dispatch(postError(error.response.data));\n  }\n};\nexport const createPost = formData => async dispatch => {\n  const config = {\n    headers: {\n      \"Content-Type\": \"application/json\"\n    }\n  };\n  try {\n    const res = await axios.post(`/api/posts`, formData, config);\n    dispatch(createPostSuccess(res.data));\n    // dispatch(setAlert(\"Post created\", \"success\"));\n  } catch (error) {\n    dispatch(postError(error.response.data));\n    console.log(error.response.data);\n  }\n};\nexport const likePost = id => async dispatch => {\n  try {\n    const res = await axios.put(`/api/posts/like/${id}`);\n    dispatch(updateLikes({\n      id,\n      likes: res.data\n    }));\n  } catch (error) {\n    dispatch(postError(error.response.data));\n  }\n};\nexport const unlikePost = id => async dispatch => {\n  try {\n    const res = await axios.put(`/api/posts/unlike/${id}`);\n    dispatch(updateLikes({\n      id,\n      likes: res.data\n    }));\n  } catch (error) {\n    dispatch(postError(error.response.data));\n  }\n};\nexport const deletePost = id => async dispatch => {\n  try {\n    await axios.delete(`/api/posts/${id}`);\n    dispatch(deletePost(id));\n    // dispatch(setAlert(\"Post deleted\", \"success\"));\n  } catch (error) {\n    dispatch(postError(error.response.data));\n  }\n};\nexport const getPost = id => async dispatch => {\n  try {\n    const res = await axios.get(`/api/posts/${id}`);\n    dispatch(getPostSuccess(res.data));\n  } catch (error) {\n    dispatch(postError(error.response.data));\n  }\n};\nexport const addComment = (postId, formData) => async dispatch => {\n  const config = {\n    headers: {\n      \"Content-Type\": \"application/json\"\n    }\n  };\n  try {\n    const res = await axios.post(`/api/posts/comment/${postId}`, formData, config);\n    dispatch(addOrRemoveComment(res.data));\n    // dispatch(setAlert(\"Comment added\", \"success\"));\n  } catch (error) {\n    dispatch(postError(error.response.data));\n  }\n};\nexport const removeComment = (postId, commentId) => async dispatch => {\n  try {\n    const res = await axios.delete(`/api/posts/comment/${postId}/${commentId}`);\n    dispatch(addOrRemoveComment(res.data));\n    // dispatch(setAlert(\"Comment removed\", \"success\"));\n  } catch (error) {\n    dispatch(postError(error.response.data));\n  }\n};\nexport default postSlice.reducer;","map":{"version":3,"names":["createSlice","axios","initialState","posts","post","error","loading","postSlice","name","reducers","getPostsSuccess","state","action","payload","createPostSuccess","unshift","postError","updateLikes","id","likes","map","_id","removePost","filter","getPostSuccess","addOrRemoveComment","comments","actions","getPosts","dispatch","token","localStorage","getItem","config","headers","res","get","data","response","createPost","formData","console","log","likePost","put","unlikePost","deletePost","delete","getPost","addComment","postId","removeComment","commentId","reducer"],"sources":["C:/Users/wangz/OneDrive/文档/GitHub/Kitten/frontend/src/Redux/Reducers/PostSlice.js"],"sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\r\nimport axios from \"axios\";\r\n// import { setAlert } from \"./alert\";\r\n\r\nconst initialState = {\r\n  posts: [],\r\n  post: null,\r\n  error: {},\r\n  loading: true,\r\n};\r\n\r\nconst postSlice = createSlice({\r\n  name: \"post\",\r\n  initialState,\r\n  reducers: {\r\n    getPostsSuccess(state, action) {\r\n      state.posts = action.payload;\r\n      state.post = null;\r\n      state.loading = false;\r\n    },\r\n    createPostSuccess(state, action) {\r\n      state.posts.unshift(action.payload);\r\n      state.loading = false;\r\n    },\r\n    postError(state, action) {\r\n      state.error = action.payload;\r\n      state.loading = false;\r\n    },\r\n    updateLikes(state, action) {\r\n      const { id, likes } = action.payload;\r\n      state.posts = state.posts.map((post) =>\r\n        post._id === id ? { ...post, likes } : post\r\n      );\r\n      state.loading = false;\r\n    },\r\n    removePost(state, action) {\r\n      state.posts = state.posts.filter((post) => post._id !== action.payload);\r\n      state.loading = false;\r\n    },\r\n    getPostSuccess(state, action) {\r\n      state.post = action.payload;\r\n      state.loading = false;\r\n    },\r\n    addOrRemoveComment(state, action) {\r\n      state.post = { ...state.post, comments: action.payload };\r\n      state.loading = false;\r\n    },\r\n  },\r\n});\r\n\r\nexport const {\r\n  getPostsSuccess,\r\n  createPostSuccess,\r\n  postError,\r\n  updateLikes,\r\n  removePost,\r\n  getPostSuccess,\r\n  addOrRemoveComment,\r\n} = postSlice.actions;\r\n\r\n// Async Thunks\r\nexport const getPosts = () => async (dispatch) => {\r\n  try {\r\n    const token = localStorage.getItem(\"token\");\r\n    const config = {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"x-auth-token\": `${token}`, // Include the token in the Authorization header\r\n      },\r\n    };\r\n    const res = await axios.get(\"/api/posts\", config);\r\n    dispatch(getPostsSuccess(res.data));\r\n  } catch (error) {\r\n    dispatch(postError(error.response.data));\r\n  }\r\n};\r\n\r\nexport const createPost = (formData) => async (dispatch) => {\r\n  const config = {\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n  };\r\n  try {\r\n    const res = await axios.post(`/api/posts`, formData, config);\r\n    dispatch(createPostSuccess(res.data));\r\n    // dispatch(setAlert(\"Post created\", \"success\"));\r\n  } catch (error) {\r\n    dispatch(postError(error.response.data));\r\n    console.log(error.response.data)\r\n  }\r\n};\r\n\r\nexport const likePost = (id) => async (dispatch) => {\r\n  try {\r\n    const res = await axios.put(`/api/posts/like/${id}`);\r\n    dispatch(updateLikes({ id, likes: res.data }));\r\n  } catch (error) {\r\n    dispatch(postError(error.response.data));\r\n  }\r\n};\r\n\r\nexport const unlikePost = (id) => async (dispatch) => {\r\n  try {\r\n    const res = await axios.put(`/api/posts/unlike/${id}`);\r\n    dispatch(updateLikes({ id, likes: res.data }));\r\n  } catch (error) {\r\n    dispatch(postError(error.response.data));\r\n  }\r\n};\r\n\r\nexport const deletePost = (id) => async (dispatch) => {\r\n  try {\r\n    await axios.delete(`/api/posts/${id}`);\r\n    dispatch(deletePost(id));\r\n    // dispatch(setAlert(\"Post deleted\", \"success\"));\r\n  } catch (error) {\r\n    dispatch(postError(error.response.data));\r\n  }\r\n};\r\n\r\nexport const getPost = (id) => async (dispatch) => {\r\n  try {\r\n    const res = await axios.get(`/api/posts/${id}`);\r\n    dispatch(getPostSuccess(res.data));\r\n  } catch (error) {\r\n    dispatch(postError(error.response.data));\r\n  }\r\n};\r\n\r\nexport const addComment = (postId, formData) => async (dispatch) => {\r\n  const config = {\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n  };\r\n  try {\r\n    const res = await axios.post(\r\n      `/api/posts/comment/${postId}`,\r\n      formData,\r\n      config\r\n    );\r\n    dispatch(addOrRemoveComment(res.data));\r\n    // dispatch(setAlert(\"Comment added\", \"success\"));\r\n  } catch (error) {\r\n    dispatch(postError(error.response.data));\r\n  }\r\n};\r\n\r\nexport const removeComment = (postId, commentId) => async (dispatch) => {\r\n  try {\r\n    const res = await axios.delete(`/api/posts/comment/${postId}/${commentId}`);\r\n    dispatch(addOrRemoveComment(res.data));\r\n    // dispatch(setAlert(\"Comment removed\", \"success\"));\r\n  } catch (error) {\r\n    dispatch(postError(error.response.data));\r\n  }\r\n};\r\n\r\nexport default postSlice.reducer;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}